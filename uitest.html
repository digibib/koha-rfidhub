<!doctype html>

<html>
<head>
  <meta charset="utf-8">
  <title>Test</title>
  <style>
    body { background: #fff; color: #222; font-family: Arial; font-size: 14px;}
    table { width: 100%;}
    th { border-bottom: 1px solid #ccc; background: #eee; text-align: left; font-size:120%;}
    td { min-width: 150px; padding: 4px;}
    h2 { background: green; padding: 4px; color: #fff}
    button { margin-right:1em;}
    li { margin-bottom:0.3em;}
    li:nth-child(odd) { background: #eee;}
    #content { width: 1000px; margin: auto;}
    #logg { font-family: monospace; list-style-type: none; padding:0; margin:0 ;}
    .tagid { width: 100px;}
    .hidden { display: none;}
    .big { line-height:1.5em; width: 220px; font-weight: bold; margin:1em; cursor: pointer;}
    .selected { border: 1px dashed #888; cursor: default;}
    .authentication { margin: 2em 0;}
    #borrower-id:before { content:'(';}
    #borrower-id:after { content: ')';}
    .tab { min-height: 300px;}
    .auth-error { background: yellow;}
  </style>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
</head>
  <div id="content">

  <h1>RFID brukergrensesnitt-test</h1>
  <hr/>
  <button id="checkin" class="big">INNLEVERING</button>
  <div class="tab checkin">
    <table>
      <thead>
        <tr>
          <th>Materiale</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr class="tr-item hidden">
          <td class="td-item"></td>
          <td class="td-status"></td>
        </tr>
      </tbody>
    </table>
  </div>
  <hr/>
  <input type="text" id="patron" placeholder="Lånenummber" /><button id="checkout" class="big">UTLÅN</button>
    <div class="tab checkout">
    <table>
      <thead>
        <tr>
          <th>Materiale</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr class="tr-item hidden">
          <td class="td-item"></td>
          <td class="td-status"></td>
        </tr>
      </tbody>
    </table>
  </div>

  <h2>Kommunikasjonslogg</h2>

  <ul id="logg">
    <li></li>
  </ul>

</div>

<body>
  <script>
  function log(line) {
    var logLine = ""+new Date()
    logLine = logLine.substring(16,24) + line;
     $('#logg').prepend('<li>'+logLine+'</li>');
  }

  $(document).ready(function() {
    var ws=new WebSocket('ws://{{.Host}}/ws');
    ws.onopen = function() {
      console.log("connected");

      ws.onmessage = function(resp) {
        var data = JSON.parse(resp.data);
        log(" <- "+resp.data);
        switch (data.Action) {
          case "CHECKIN":
            log(" checkin item");
            break;
          case "CHECKOUT":
            log("checkout item");
            break;
          default:
            log("Unknown message:" + resp.data);
        }
      };
    };
    ws.onclose = function() {
      console.log("disconected");
      // TODO try to reconnecd SetInterval 1 sec
    };

    $('#checkout').on('click', function() {
      msg = JSON.stringify({Action: "CHECKOUT", Patron: $('#patron').val()});
      log(" -> "+msg);
      ws.send(msg);
    });

    $('#checkin').on('click', function() {
      msg = JSON.stringify({Action: "CHECKIN"});
      log(" -> "+msg);
      ws.send(msg);
    });

    $('#alarmon').on('click', function() {
      console.log('alarm on');
    });

    $('#alarmoff').on('click', function() {
      console.log('alarm off');
    });

  });
  </script>
</body>
</html>